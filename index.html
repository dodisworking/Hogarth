<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ogilvy X Hogarth Jar Tracker</title>
    <style>
      :root {
        --bg: #f8fafc;
        --panel: #ffffff;
        --ink: #0f172a;
        --muted: #64748b;
        --line: #e2e8f0;
        --accent: #2563eb;
        --accent-2: #60a5fa;
        --accent-3: #93c5fd;
        --radius: 16px;
        --jarW: 220px;
        --jarH: 320px;
      }

      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--ink);
        background: var(--bg);
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: saturate(180%) blur(6px);
        border-bottom: 1px solid var(--line);
        padding: 10px 16px;
      }
      .wrap {
        max-width: 1100px;
        margin: 0 auto;
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      }
      .title {
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .actions {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
      }
      .countdown {
        font-variant-numeric: tabular-nums;
        font-size: 14px;
        color: var(--ink);
      }
      .countdown .label {
        color: var(--muted);
        margin-right: 6px;
      }

      main {
        padding: 20px 16px 40px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      @media (min-width: 900px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 20px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
      }
      .card.pad {
        padding: 16px;
      }
      .card h2 {
        margin: 0 0 10px;
        font-size: 18px;
      }

      label {
        display: block;
        font-size: 12px;
        color: var(--muted);
        margin: 8px 0 4px;
      }
      input[type="text"],
      input[type="date"] {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--line);
        border-radius: 12px;
        outline: none;
      }
      input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
      }
      .btn {
        cursor: pointer;
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 10px 14px;
        background: var(--panel);
        color: var(--ink);
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .btn.primary {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }
      .btn.small {
        padding: 6px 10px;
        border-radius: 10px;
        font-size: 12px;
      }
      .stack {
        display: grid;
        gap: 12px;
      }

      .stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .stat {
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 10px 12px;
      }
      .stat .k {
        font-size: 12px;
        color: var(--muted);
      }
      .stat .v {
        font-size: 18px;
        font-weight: 700;
      }

      .pbar {
        height: 12px;
        background: #e5e7eb;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid var(--line);
      }
      .pbar > .fill {
        height: 100%;
        width: 0%;
        background: var(--accent);
        transition: width 0.7s ease;
      }

      /* Jar visuals */
      .jar-wrap {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 18px;
        align-items: center;
      }
      .neck {
        width: calc(var(--jarW) * 0.55);
        height: 36px;
        margin: 0 auto 8px;
        background: #eef2f7;
        border: 2px solid #cbd5e1;
        border-radius: 8px;
      }
      .jar-outer {
        position: relative;
      }
      .jar {
        width: var(--jarW);
        height: var(--jarH);
        border: 3px solid #94a3b8;
        border-radius: 80px;
        position: relative;
        overflow: hidden;
        background: linear-gradient(
          180deg,
          #ffffff 0%,
          #f8fafc 60%,
          #f1f5f9 100%
        );
      }
      .jar .water {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 0%;
        background: linear-gradient(180deg, var(--accent-2), var(--accent-3));
        transition: height 0.8s ease;
      }
      .jar .wave {
        content: "";
        position: absolute;
        left: -25%;
        width: 150%;
        height: 18px;
        bottom: calc(var(--h) - 18px);
        background: radial-gradient(
          circle at 16px 8px,
          rgba(255, 255, 255, 0.75) 0 10px,
          transparent 11px
        );
        background-size: 32px 18px;
        opacity: 0.55;
        pointer-events: none;
        transition: bottom 0.8s ease;
      }
      .ticks {
        position: absolute;
        right: -38px;
        top: 0;
        bottom: 0;
        width: 38px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-start;
        padding: 12px 0;
      }
      .ticks .tick {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        color: var(--muted);
      }
      .ticks .tick::before {
        content: "";
        width: 10px;
        height: 1px;
        background: #94a3b8;
        display: inline-block;
      }

      /* Pour animation */
      .pour {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        top: -20px;
        width: 22px;
        height: 0;
        background: linear-gradient(180deg, #93c5fd, #60a5fa);
        border-radius: 10px;
        opacity: 0;
        pointer-events: none;
      }
      .pour.show {
        animation: pourDown 1s ease-in-out forwards;
      }
      @keyframes pourDown {
        0% {
          height: 0;
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        60% {
          height: var(--jarH);
        }
        100% {
          height: 0;
          opacity: 0;
        }
      }

      /* Confetti canvas */
      #confettiCanvas {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 9999;
      }

      footer {
        text-align: center;
        padding: 20px 0 40px;
        font-size: 12px;
        color: var(--muted);
      }

      /* List view */
      .table {
        width: 100%;
        border-collapse: collapse;
      }
      .table th,
      .table td {
        border-bottom: 1px solid var(--line);
        padding: 10px 8px;
        text-align: left;
      }
      .table th {
        font-size: 12px;
        color: var(--muted);
        font-weight: 600;
      }
      .table td {
        font-size: 14px;
      }
      .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }

      .hidden {
        display: none;
      }

      /* Password gate styles */
      .gate {
        position: fixed;
        inset: 0;
        background: rgba(15, 23, 42, 0.65);
        backdrop-filter: blur(4px);
        display: grid;
        place-items: center;
        z-index: 10000;
      }
      .gate.hidden {
        display: none;
      }
      .gate-card {
        width: min(420px, 92vw);
        background: var(--panel);
        border: 1px solid var(--line);
        border-radius: 18px;
        padding: 18px;
        box-shadow: 0 10px 28px rgba(0, 0, 0, 0.18);
      }
      .gate-card h3 {
        margin: 0 0 6px;
      }
      .shake {
        animation: shake 420ms ease;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-10px);
        }
        40% {
          transform: translateX(8px);
        }
        60% {
          transform: translateX(-6px);
        }
        80% {
          transform: translateX(4px);
        }
      }

      /* Leaderboards */
      .leader-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }
      @media (min-width: 900px) {
        .leader-grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      .podium {
        display: grid;
        grid-template-rows: auto 1fr;
        gap: 10px;
        border: 1px solid var(--line);
        border-radius: 16px;
        padding: 14px;
      }
      .podium h3 {
        margin: 0;
        font-size: 16px;
      }
      .podium-stand {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        align-items: end;
        height: 180px;
      }
      .place {
        position: relative;
        background: #eef2ff;
        border: 1px solid #c7d2fe;
        border-radius: 10px;
        display: grid;
        align-content: end;
        justify-items: center;
        padding-bottom: 8px;
      }
      .place .name {
        font-size: 12px;
        font-weight: 700;
        text-align: center;
        padding: 4px 6px;
      }
      .place .metric {
        font-size: 12px;
        color: var(--muted);
      }
      .place .medal {
        position: absolute;
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        background: #fff;
        border: 1px solid var(--line);
        padding: 2px 6px;
        border-radius: 999px;
      }
      .legend {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }
      .proj-card .rowline {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        font-size: 14px;
      }
      .mono {
        font-variant-numeric: tabular-nums;
      }
    </style>

    <!-- SheetJS for Excel export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  </head>
  <body>
    <header>
      <div class="wrap row">
        <div class="title">Ogilvy X Hogarth Jar Tracker</div>
        <div class="actions">
          <a
            id="toggleLink"
            href="#list"
            class="btn small"
            aria-label="Show/Edit Submissions"
            >Show/Edit Submissions</a
          >
          <a
            id="leadersLink"
            href="#leaders"
            class="btn small"
            aria-label="Leaderboards"
            >Leaderboards</a
          >
          <button id="dlXLSXHeader" class="btn small" type="button">
            Download Excel
          </button>
          <div class="countdown">
            <span class="label">Countdown to Dec 31:</span
            ><span id="countdown" class="mono">loading...</span>
          </div>
        </div>
      </div>
    </header>

    <main class="wrap">
      <!-- Main tracker view -->
      <section id="viewMain">
        <div class="grid">
          <section class="card pad">
            <h2>Add Award</h2>
            <form id="awardForm" class="stack">
              <div>
                <label>Project Name</label>
                <input
                  id="fProject"
                  type="text"
                  placeholder="e.g., Verizon Fios Launch"
                  required
                />
              </div>
              <div class="row" style="gap: 12px; align-items: flex-end">
                <div style="flex: 1">
                  <label>Client</label>
                  <input
                    id="fClient"
                    type="text"
                    placeholder="e.g., Verizon"
                    required
                  />
                </div>
                <div style="flex: 1">
                  <label>Producer</label>
                  <input
                    id="fProducer"
                    type="text"
                    placeholder="e.g., Isaac D."
                    required
                  />
                </div>
              </div>
              <div class="row" style="gap: 12px; align-items: flex-end">
                <div style="flex: 1">
                  <label>Job Number</label>
                  <input
                    id="fJob"
                    type="text"
                    placeholder="e.g., VZN-2417"
                    required
                  />
                </div>
                <div style="flex: 1">
                  <label>Date of Award</label>
                  <input id="fDate" type="date" required />
                </div>
              </div>
              <div>
                <label>Dollar Amount</label>
                <input
                  id="fAmount"
                  type="text"
                  inputmode="decimal"
                  placeholder="$250,000"
                  required
                />
              </div>
              <div class="row" style="justify-content: space-between">
                <button class="btn primary" type="submit">Add to Jar</button>
                <a class="btn" href="#list">Show/Edit Submissions</a>
              </div>
            </form>
          </section>

          <section class="card pad">
            <h2>Ogilvy X Hogarth Jar Tracker</h2>
            <div
              class="muted"
              id="goalLine"
              style="font-size: 14px; margin-bottom: 14px"
            ></div>

            <div class="jar-wrap">
              <div class="jar-outer">
                <div class="neck"></div>
                <div class="pour" id="pour"></div>
                <div class="jar">
                  <div id="water" class="water"></div>
                  <div id="wave" class="wave" style="--h: 0%"></div>
                  <div class="ticks">
                    <div class="tick">100%</div>
                    <div class="tick">75%</div>
                    <div class="tick">50%</div>
                    <div class="tick">25%</div>
                    <div class="tick">0%</div>
                  </div>
                </div>
              </div>

              <div class="stack">
                <div class="stats">
                  <div class="stat">
                    <div class="k">Current Total</div>
                    <div id="totalOut" class="v mono">$0</div>
                  </div>
                  <div class="stat">
                    <div class="k">Remaining</div>
                    <div id="remainingOut" class="v mono">$0</div>
                  </div>
                </div>
                <div>
                  <div
                    class="row"
                    style="
                      justify-content: space-between;
                      font-size: 12px;
                      color: var(--muted);
                      margin-bottom: 6px;
                    "
                  >
                    <div>Progress</div>
                    <div class="mono" id="pctOut">0%</div>
                  </div>
                  <div class="pbar"><div id="pfill" class="fill"></div></div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- Submissions list view -->
      <section id="viewList" class="hidden">
        <div class="card pad">
          <div class="toolbar">
            <h2>Submissions</h2>
            <div class="actions">
              <a href="#" class="btn small">Back to Tracker</a>
              <button id="dlXLSX" class="btn small" type="button">
                Download Excel
              </button>
              <button id="clearBtn" class="btn small" type="button">
                Clear All
              </button>
            </div>
          </div>
          <div style="overflow: auto">
            <table class="table" id="submissionsTable">
              <thead>
                <tr>
                  <th>Project</th>
                  <th>Client</th>
                  <th>Producer</th>
                  <th>Job</th>
                  <th>Date</th>
                  <th>Amount</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="subsBody"></tbody>
            </table>
          </div>
          <div
            id="emptyState"
            class="muted"
            style="font-size: 14px; padding-top: 10px"
          >
            No submissions yet.
          </div>
        </div>
      </section>

      <!-- Leaderboards view -->
      <section id="viewLeaders" class="hidden">
        <div class="grid">
          <section class="card pad proj-card">
            <h2>Projection Report</h2>
            <div id="projectionText" class="rowline"></div>
          </section>

          <section class="card pad">
            <div class="toolbar">
              <h2>Leaderboards</h2>
              <div class="actions">
                <a href="#" class="btn small" aria-label="Back to Tracker"
                  >Back to Tracker</a
                >
              </div>
            </div>

            <div class="leader-grid">
              <div class="podium">
                <h3>Top Producers by Total Hogarth Spend</h3>
                <div id="podiumSpend" class="podium-stand"></div>
                <div id="legendSpend" class="legend"></div>
              </div>
              <div class="podium">
                <h3>Top Producers by Project Count</h3>
                <div id="podiumCount" class="podium-stand"></div>
                <div id="legendCount" class="legend"></div>
              </div>
            </div>
          </section>
        </div>
      </section>
    </main>

    <!-- Password Gate -->
    <div id="gate" class="gate hidden" aria-modal="true" role="dialog">
      <div class="gate-card">
        <h3>Enter Password</h3>
        <p class="muted" style="margin-top: -6px">This site is restricted.</p>
        <label for="gateInput" style="margin-top: 10px">Password</label>
        <input id="gateInput" type="password" placeholder="Enter password" />
        <div
          class="row"
          style="justify-content: flex-end; margin-top: 12px; gap: 8px"
        >
          <button id="gateBtn" class="btn primary">Unlock</button>
        </div>
        <div
          id="gateError"
          class="muted"
          style="color: #b91c1c; display: none; margin-top: 8px"
        >
          Incorrect password. Try again.
        </div>
      </div>
    </div>

    <footer>Edit GOAL in the script if you need a different number.</footer>

    <canvas id="confettiCanvas"></canvas>

    <script>
      // Config
      const GOAL = 4_000_000;
      const BASELINE = 0; // hidden in UI if zero
      const STORAGE_KEY = "ogilvy-hogarth-jar-v1";
      const TARGET = new Date("2025-12-31T23:59:59"); // local time

      // DOM
      const elCountdown = document.getElementById("countdown");
      const elForm = document.getElementById("awardForm");
      const elWater = document.getElementById("water");
      const elWave = document.getElementById("wave");
      const elTotal = document.getElementById("totalOut");
      const elRemain = document.getElementById("remainingOut");
      const elPct = document.getElementById("pctOut");
      const elFill = document.getElementById("pfill");
      const goalLine = document.getElementById("goalLine");
      const toggleLink = document.getElementById("toggleLink");
      const leadersLink = document.getElementById("leadersLink");
      const gate = document.getElementById("gate");
      const gateBtn = document.getElementById("gateBtn");
      const gateInput = document.getElementById("gateInput");
      const gateError = document.getElementById("gateError");
      const elPour = document.getElementById("pour");
      const confettiCanvas = document.getElementById("confettiCanvas");
      const ctx = confettiCanvas.getContext("2d");

      const fProject = document.getElementById("fProject");
      const fClient = document.getElementById("fClient");
      const fProducer = document.getElementById("fProducer");
      const fJob = document.getElementById("fJob");
      const fDate = document.getElementById("fDate");
      const fAmount = document.getElementById("fAmount");

      const viewMain = document.getElementById("viewMain");
      const viewList = document.getElementById("viewList");
      const viewLeaders = document.getElementById("viewLeaders");
      const subsBody = document.getElementById("subsBody");
      const emptyState = document.getElementById("emptyState");
      const clearBtn = document.getElementById("clearBtn");
      const dlXLSX = document.getElementById("dlXLSX");
      const dlXLSXHeader = document.getElementById("dlXLSXHeader");

      const podiumSpend = document.getElementById("podiumSpend");
      const podiumCount = document.getElementById("podiumCount");
      const legendSpend = document.getElementById("legendSpend");
      const legendCount = document.getElementById("legendCount");
      const projectionText = document.getElementById("projectionText");

      const fmt = new Intl.NumberFormat("en-US", {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0,
      });

      // Goal line text
      function renderGoalLine() {
        if (BASELINE > 0) {
          goalLine.textContent = `Baseline ${fmt.format(
            BASELINE
          )} toward ${fmt.format(GOAL)} goal`;
        } else {
          goalLine.textContent = `Goal ${fmt.format(GOAL)}`;
        }
      }

      // State
      let entries = [];
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) entries = JSON.parse(raw);
      } catch {}

      // Seed data if empty
      if (!entries || entries.length === 0) {
        const seedProjects = [
          "Faces of Frontline Social",
          "Disaster Tampa",
          "Verizon VHI Mid-winter - Router Shoot",
          "FWA I heart radio",
          "Q3 LGPO radio",
          "July promo radio",
          "VHI Summer Radio",
          "VBG Enterprise radio",
          "Mobility Q3 Radio",
          "June Promo",
          "June Promo Overages",
          "Holiday reship",
          "My biz radio",
          "JD Power radio",
          "Q3 Social",
          "Eli in the Park",
          "Mel Robbins shoot/edit",
          "Disaster Resilience",
          "OOH BOSTON",
          "OOH NYC",
          "OOH Philadelphia",
          "Stacked content capture",
          "Real Work campaign",
          "Rewards",
          "Kiehl’s Acne",
          "Kiehl’s UV",
          "Agree to agree",
        ];
        const seedJobs = [
          "VZW.VZWVBG.25161.Q.011",
          "VZW.VZWCSR.25044.Q.011",
          "VZW.VZWVCG.25029.F.011",
          "VZW.VZWVCG.25208.S.011",
          "VZW.VZWVCG.25265.S.011",
          "VZW.VZWVCG.25308.S>011",
          "VZW.VZWVCG.25318.F.011",
          "VZW.VZWVBG.25194.S.011",
          "VZW.VZWBCG.25358.S.011",
          "VZW.VZWVCG.25282",
          "VZW.VZWVCG.25282",
          "IKE.IKEGEN.19817.F.011",
          "VZW.VZWVBG.25163.S.011",
          "VZW.VZWVBG.25178.S.011",
          "CIZ.CIZBRD.25032.B.011",
          "CIZ.CIZBRD.25034.F.011",
          "VZW.VZWCSR.25048.B.011",
          "VZW.VZWCSR.25026.B.011",
          "CIZ.CIZBRD.25035.W.011",
          "CIZ.CIZBRD.25036.W.011",
          "CIZ.CIZBRD.25041.F.011",
          "CIZ.CIZBRD.25018.B.011",
          "IMN.IMNBRP.25018.B.011",
          "IKE.IKEGEN.25145.F.011",
          "LCD.LCDKIE.25001.B.013",
          "LCD.LCDKIE.25002.B.011",
          "AD.Adpro.25000.F.011",
        ];
        const seedClients = [
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Verizon",
          "Ikea",
          "Verizon",
          "Verizon",
          "Citizen's",
          "Citizen's",
          "Verizon",
          "Verizon",
          "Citizen's",
          "Citizen's",
          "Citizen's",
          "Citizen's",
          "IBM",
          "IKEA",
          "Kiehl’s",
          "Kiehl’s",
          "Ad Council",
        ];
        const seedDates = [
          "7/15/2025",
          "5/29/2025",
          "02/21/25",
          "5/30/2025",
          "6/18/2025",
          "6/24/2025",
          "7/7/2025",
          "7/22/2025",
          "8/4/2025",
          "6/1/2025",
          "6/25/2025",
          "5/1/2025",
          "5/21/2025",
          "5/20/2025",
          "6/17/2025",
          "8/4/2025",
          "8/3/2025",
          "5/23/2025",
          "7/29/2025",
          "7/3/2025",
          "6/30/2025",
          "8/11/2025",
          "4/11/2025",
          "7/9/2025",
          "4/21/2025",
          "04/03/2025",
          "6/25/2025",
        ];
        const seedProducers = [
          "Eduardo Dañino",
          "Eduardo Dañino",
          "Eduardo Dañino",
          "Isaac Boruchowicz",
          "Isaac Boruchowicz",
          "Isaac Boruchowicz",
          "Isaac Boruchowicz",
          "Isaac Boruchowicz",
          "Isaac Boruchowicz",
          "Jess Coccaro",
          "Jess Coccaro",
          "Katie Greene",
          "Liv Hatcher",
          "Liv Hatcher",
          "Manny Roblero",
          "Manny Roblero",
          "Mark Licea",
          "Mark Licea",
          "Mel Hill",
          "Mel Hill",
          "Mel Hill",
          "Mel Hill",
          "Michele Salinas",
          "Rachel Scheff",
          "Rachel Scheff",
          "Rachel Scheff",
          "Roy De La Maza",
        ];
        const seedAmounts = [
          "148,420.00",
          "127,256.60",
          "$48,744.60",
          "2,700.00",
          "13,550.00",
          "2,600.00",
          "3,600.00",
          "7,325.00",
          "5,055.51",
          "331,775.00",
          "82,000",
          "3,640.00",
          "9,734.00",
          "28,738.06",
          "20,810.00",
          "30,468.75",
          "126,184.34",
          "103,687.66",
          "40,652.01",
          "55,364.00",
          "31,855.00",
          "200,000.00",
          "221,602.00",
          "8,590.00",
          "30,382.00",
          "12,495",
          "18,575.00",
        ];

        function toISO(s) {
          const m = s.trim().match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);
          if (!m) return s;
          let [_, mm, dd, yy] = m;
          let year = Number(yy);
          if (yy.length === 2) year = year < 50 ? 2000 + year : 1900 + year;
          const month = String(Number(mm)).padStart(2, "0");
          const day = String(Number(dd)).padStart(2, "0");
          return `${year}-${month}-${day}`;
        }
        function parseAmount(v) {
          const n = Number(String(v).replace(/[^0-9.-]/g, ""));
          return isFinite(n) ? n : 0;
        }

        entries = seedProjects.map((project, i) => ({
          id: crypto.randomUUID(),
          project: project.trim(),
          client: (seedClients[i] || "").trim(),
          producer: (seedProducers[i] || "").trim(),
          job: (seedJobs[i] || "").trim(),
          date: toISO(seedDates[i] || ""),
          amount: parseAmount(seedAmounts[i] || 0),
        }));
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        } catch {}
      }

      // Countdown
      function tickCountdown() {
        const now = new Date();
        const diff = Math.max(0, TARGET.getTime() - now.getTime());
        const sec = Math.floor(diff / 1000) % 60;
        const min = Math.floor(diff / (1000 * 60)) % 60;
        const hr = Math.floor(diff / (1000 * 60 * 60)) % 24;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        elCountdown.textContent = `${days}d ${hr}h ${min}m ${sec}s`;
      }
      tickCountdown();
      setInterval(tickCountdown, 1000);

      function save() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        } catch {}
      }
      function parseAmountInput(v) {
        const n = Number(String(v).replace(/[^0-9.-]/g, ""));
        return isFinite(n) ? n : 0;
      }

      function renderStats() {
        const totalFromEntries = entries.reduce((sum, e) => sum + e.amount, 0);
        const currentTotal = BASELINE + totalFromEntries;
        const remaining = Math.max(0, GOAL - currentTotal);
        const pct = Math.max(0, Math.min(1, currentTotal / GOAL));
        elTotal.textContent = fmt.format(currentTotal);
        elRemain.textContent = fmt.format(remaining);
        elPct.textContent = Math.round(pct * 100) + "%";
        elFill.style.width = pct * 100 + "%";
        const h = Math.round(pct * 100);
        elWater.style.height = h + "%";
        elWave.style.setProperty("--h", h + "%");
      }

      // Pour + confetti
      function playPour() {
        elPour.classList.remove("show");
        void elPour.offsetWidth;
        elPour.classList.add("show");
        setTimeout(() => elPour.classList.remove("show"), 1000);
      }
      function resizeCanvas() {
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas);
      resizeCanvas();
      function confettiBurst(count = 120) {
        const particles = [];
        for (let i = 0; i < count; i++) {
          particles.push({
            x: confettiCanvas.width / 2,
            y: confettiCanvas.height * 0.25,
            vx: (Math.random() - 0.5) * 8,
            vy: Math.random() * -8 - 4,
            g: 0.25 + Math.random() * 0.2,
            size: 4 + Math.random() * 6,
            life: 90 + Math.random() * 40,
            hue: Math.floor(200 + Math.random() * 160),
          });
        }
        let frame = 0;
        function step() {
          ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
          for (const p of particles) {
            p.vy += p.g;
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 1;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate((((p.x + p.y + frame) % 360) * Math.PI) / 180);
            ctx.fillStyle = `hsl(${p.hue}, 90%, 60%)`;
            ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
            ctx.restore();
          }
          frame++;
          if (
            particles.some(
              (p) => p.life > 0 && p.y < confettiCanvas.height + 20
            )
          )
            requestAnimationFrame(step);
          else ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
        }
        step();
      }
      function pourAndCelebrate() {
        playPour();
        confettiBurst(140);
      }

      // List rendering
      function addRow(e) {
        const tr = document.createElement("tr");
        tr.dataset.id = e.id;
        const cells = [
          e.project,
          e.client,
          e.producer,
          e.job,
          new Date(e.date + "T00:00:00").toLocaleDateString(),
          fmt.format(e.amount),
        ];
        for (const text of cells) {
          const td = document.createElement("td");
          td.textContent = text;
          tr.appendChild(td);
        }
        const tdAct = document.createElement("td");
        const btnEdit = document.createElement("button");
        btnEdit.className = "btn small";
        btnEdit.textContent = "Edit";
        const btnDel = document.createElement("button");
        btnDel.className = "btn small";
        btnDel.style.marginLeft = "6px";
        btnDel.textContent = "Delete";
        tdAct.appendChild(btnEdit);
        tdAct.appendChild(btnDel);
        tr.appendChild(tdAct);

        btnDel.addEventListener("click", () => {
          entries = entries.filter((x) => x.id !== e.id);
          save();
          renderList();
          renderStats();
        });
        btnEdit.addEventListener("click", () => startEdit(tr, e));
        subsBody.appendChild(tr);
      }

      function startEdit(tr, e) {
        tr.innerHTML = "";
        function mkInput(val, type = "text") {
          const i = document.createElement("input");
          i.type = type;
          i.value = val;
          i.style.width = "100%";
          i.style.padding = "8px 10px";
          i.style.border = "1px solid var(--line)";
          i.style.borderRadius = "10px";
          return i;
        }
        const iProj = mkInput(e.project);
        const iClient = mkInput(e.client);
        const iProd = mkInput(e.producer);
        const iJob = mkInput(e.job);
        const iDate = mkInput(e.date, "date");
        const iAmt = mkInput(e.amount, "text");
        const inputs = [iProj, iClient, iProd, iJob, iDate, iAmt];
        for (const i of inputs) {
          const td = document.createElement("td");
          td.appendChild(i);
          tr.appendChild(td);
        }
        const tdAct = document.createElement("td");
        const btnSave = document.createElement("button");
        btnSave.className = "btn small primary";
        btnSave.textContent = "Save";
        const btnCancel = document.createElement("button");
        btnCancel.className = "btn small";
        btnCancel.textContent = "Cancel";
        btnCancel.style.marginLeft = "6px";
        tdAct.appendChild(btnSave);
        tdAct.appendChild(btnCancel);
        tr.appendChild(tdAct);

        btnCancel.addEventListener("click", renderList);
        btnSave.addEventListener("click", () => {
          const newAmt = parseAmountInput(iAmt.value);
          const updated = {
            ...e,
            project: iProj.value.trim(),
            client: iClient.value.trim(),
            producer: iProd.value.trim(),
            job: iJob.value.trim(),
            date: iDate.value,
            amount: newAmt,
          };
          const idx = entries.findIndex((x) => x.id === e.id);
          if (idx !== -1) entries[idx] = updated;
          save();
          renderList();
          renderStats();
        });
      }

      function renderList() {
        subsBody.innerHTML = "";
        if (entries.length === 0) {
          emptyState.style.display = "block";
          return;
        }
        emptyState.style.display = "none";
        for (const e of entries) addRow(e);
      }

      // Leaderboards
      function groupByProducer() {
        const map = new Map();
        for (const e of entries) {
          if (!map.has(e.producer))
            map.set(e.producer, { producer: e.producer, spend: 0, count: 0 });
          const rec = map.get(e.producer);
          rec.spend += Number(e.amount) || 0;
          rec.count += 1;
        }
        return Array.from(map.values());
      }

      function podiumHTML(items, type) {
        // items is assumed top 3 sorted desc by the metric
        const leaderVal = items[0]
          ? type === "spend"
            ? items[0].spend
            : items[0].count
          : 0;
        function barHeight(v) {
          if (leaderVal <= 0) return 20;
          const pct = Math.max(0.25, v / leaderVal); // keep visible
          return Math.round(80 + pct * 100); // 80 to 180 px approx
        }
        const medals = ["1st", "2nd", "3rd"];
        const boxes = items
          .map((it, idx) => {
            const val = type === "spend" ? it.spend : it.count;
            const behind = idx === 0 ? 0 : leaderVal - val;
            const metricText =
              type === "spend" ? fmt.format(val) : `${val} projects`;
            const behindText =
              idx === 0
                ? "Leader"
                : type === "spend"
                ? `${fmt.format(behind)} behind`
                : `${behind} behind`;
            const h = barHeight(val);
            return `
            <div class="place" style="height:${h}px">
              <div class="medal">${medals[idx]}</div>
              <div class="name">${it.producer || "Unknown"}</div>
              <div class="metric">${metricText}</div>
              <div class="metric" style="font-size:11px">${behindText}</div>
            </div>
          `;
          })
          .join("");
        return boxes || `<div class="muted">No data yet</div>`;
      }

      function renderLeaderboards() {
        const rows = groupByProducer();
        const bySpend = [...rows].sort((a, b) => b.spend - a.spend).slice(0, 3);
        const byCount = [...rows].sort((a, b) => b.count - a.count).slice(0, 3);

        podiumSpend.innerHTML = podiumHTML(bySpend, "spend");
        podiumCount.innerHTML = podiumHTML(byCount, "count");

        if (bySpend.length) {
          legendSpend.textContent = `Ranking uses total awarded to Hogarth per producer.`;
        } else {
          legendSpend.textContent = "";
        }
        if (byCount.length) {
          legendCount.textContent = `Ranking uses number of projects awarded to Hogarth per producer.`;
        } else {
          legendCount.textContent = "";
        }

        renderProjection();
      }

      function renderProjection() {
        const totalFromEntries = entries.reduce((sum, e) => sum + e.amount, 0);
        const currentTotal = BASELINE + totalFromEntries;
        const remaining = Math.max(0, GOAL - currentTotal);

        const now = new Date();
        const msLeft = Math.max(0, TARGET.getTime() - now.getTime());
        const daysLeft = Math.ceil(msLeft / (1000 * 60 * 60 * 24));
        const weeksLeft = Math.max(1, Math.ceil(daysLeft / 7));
        const monthsLeft = Math.max(1, Math.ceil(daysLeft / 30.4375));

        const perWeek = remaining / weeksLeft;
        const perMonth = remaining / monthsLeft;

        projectionText.innerHTML = `
          <div><strong>Time left:</strong> <span class="mono">${daysLeft} days</span></div>
          <div><strong>Remaining to goal:</strong> <span class="mono">${fmt.format(
            remaining
          )}</span></div>
          <div><strong>Needed per week:</strong> <span class="mono">${fmt.format(
            perWeek
          )}</span></div>
          <div><strong>Needed per month:</strong> <span class="mono">${fmt.format(
            perMonth
          )}</span></div>
        `;
      }

      function renderAll() {
        renderGoalLine();
        renderStats();
        if (location.hash === "#list") renderList();
        if (location.hash === "#leaders") renderLeaderboards();
      }

      // Routing
      function updateRoute() {
        const isList = location.hash === "#list";
        const isLeaders = location.hash === "#leaders";
        viewMain.classList.toggle("hidden", isList || isLeaders);
        viewList.classList.toggle("hidden", !isList);
        viewLeaders.classList.toggle("hidden", !isLeaders);

        // Keep the toggle link label static. The href controls destination.
        toggleLink.textContent = "Show/Edit Submissions";
        toggleLink.setAttribute("aria-label", "Show/Edit Submissions");
        toggleLink.setAttribute("href", "#list");

        if (isList) renderList();
        if (isLeaders) renderLeaderboards();
      }
      window.addEventListener("hashchange", updateRoute);
      toggleLink.addEventListener("click", (e) => {
        // let the hash work
      });

      // Excel export
      function exportToExcel() {
        const rows = entries.map((r) => ({
          Project: r.project,
          Client: r.client,
          Producer: r.producer,
          Job: r.job,
          Date: r.date,
          Amount: Number(r.amount) || 0,
        }));

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.json_to_sheet(rows, {
          header: ["Project", "Client", "Producer", "Job", "Date", "Amount"],
        });
        // Format amount as currency for Excel
        const range = XLSX.utils.decode_range(ws["!ref"] || "A1:A1");
        for (let R = range.s.r + 1; R <= range.e.r; ++R) {
          const cellAddr = XLSX.utils.encode_cell({ r: R, c: 5 }); // column F Amount
          if (!ws[cellAddr]) continue;
          ws[cellAddr].t = "n";
          ws[cellAddr].z = "$#,##0";
        }
        XLSX.utils.book_append_sheet(wb, ws, "Submissions");

        // Summary sheet with projections
        const totalFromEntries = entries.reduce(
          (sum, e) => sum + (Number(e.amount) || 0),
          0
        );
        const currentTotal = BASELINE + totalFromEntries;
        const remaining = Math.max(0, GOAL - currentTotal);
        const now = new Date();
        const msLeft = Math.max(0, TARGET.getTime() - now.getTime());
        const daysLeft = Math.ceil(msLeft / (1000 * 60 * 60 * 24));
        const weeksLeft = Math.max(1, Math.ceil(daysLeft / 7));
        const monthsLeft = Math.max(1, Math.ceil(daysLeft / 30.4375));
        const perWeek = remaining / weeksLeft;
        const perMonth = remaining / monthsLeft;

        const summary = [
          ["Goal", GOAL],
          ["Baseline", BASELINE],
          ["Current Total", currentTotal],
          ["Remaining", remaining],
          ["Days Left", daysLeft],
          ["Needed Per Week", perWeek],
          ["Needed Per Month", perMonth],
        ];
        const ws2 = XLSX.utils.aoa_to_sheet(summary);
        // Currency formats
        [["B1"], ["B2"], ["B3"], ["B4"], ["B6"], ["B7"]].forEach(([addr]) => {
          if (ws2[addr]) {
            ws2[addr].t = "n";
            ws2[addr].z = "$#,##0";
          }
        });
        XLSX.utils.book_append_sheet(wb, ws2, "Summary");

        const fn = `ogilvy_hogarth_submissions_${new Date()
          .toISOString()
          .slice(0, 10)}.xlsx`;
        XLSX.writeFile(wb, fn);
      }

      dlXLSX?.addEventListener("click", exportToExcel);
      dlXLSXHeader?.addEventListener("click", exportToExcel);

      // Form submit
      elForm.addEventListener("submit", function (ev) {
        ev.preventDefault();
        const amount = parseAmountInput(fAmount.value);
        if (
          !fProject.value.trim() ||
          !fClient.value.trim() ||
          !fProducer.value.trim() ||
          !fJob.value.trim() ||
          !fDate.value
        )
          return;
        if (!(amount > 0)) return;
        entries.unshift({
          id: crypto.randomUUID(),
          project: fProject.value.trim(),
          client: fClient.value.trim(),
          producer: fProducer.value.trim(),
          job: fJob.value.trim(),
          date: fDate.value,
          amount,
        });
        save();
        renderAll();
        pourAndCelebrate();
        elForm.reset();
        fProject.focus();
      });

      // Clear all
      clearBtn.addEventListener("click", function () {
        if (!confirm("Clear all submissions?")) return;
        entries = [];
        save();
        renderList();
        renderStats();
        if (location.hash === "#leaders") renderLeaderboards();
      });

      // Password gate
      const PW = "Ogilvy"; // case sensitive
      function showGate() {
        gate.classList.remove("hidden");
        gateInput.value = "";
        gateInput.focus();
      }
      function hideGate() {
        gate.classList.add("hidden");
      }
      function unlockIfOk() {
        if (gateInput.value === PW) {
          sessionStorage.setItem("fj_unlocked", "1");
          gateError.style.display = "none";
          hideGate();
          return true;
        }
        gateError.style.display = "block";
        gate.querySelector(".gate-card").classList.remove("shake");
        void gate.offsetWidth;
        gate.querySelector(".gate-card").classList.add("shake");
        return false;
      }
      gateBtn?.addEventListener("click", unlockIfOk);
      gateInput?.addEventListener("keydown", (e) => {
        if (e.key === "Enter") unlockIfOk();
      });

      // First paint
      if (sessionStorage.getItem("fj_unlocked") !== "1") showGate();
      else hideGate();
      tickCountdown();
      updateRoute();
      renderAll();
    </script>
  </body>
</html>
